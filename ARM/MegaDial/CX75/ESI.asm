	RSEG	PATCH_ESI:CODE:ROOT
	CODE16
	LDR	R3,=ESI_PATCH
	BX	R3

	RSEG	CODE:CODE:NOROOT
	CODE32
	EXTERN	ESI
ESI_PATCH:
	MOV	R3,R0,LSR #+0x1C
	CMP	R3,#0x0A
        CMPNE	R3,#0x0B
	BNE	DO_LGP
	BL	ESI
	LDMFD	SP!,{R4,PC}
DO_LGP:
	LDR	R3,=0xA0A84774+1
	MOV	R4,R1
	MOV	R1,R2
	LDR	R2,=0x2710
	CMP	R0,R2
	BX	R3
	END
